<!DOCTYPE html>
<html lang="en">

<head>
    <title>CASA Viewer - Camera for Situation Awareness</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../static/style.css"> <!-- Updated path -->
    <script>
        class ProjectionView extends HTMLCanvasElement {
            conn;
            ctx;
            currData;

            constructor() {
                super();
            }

            connectedCallback() {
                this.conn = new WebSocket("/video");
                this.conn.addEventListener("message", this.handleMessage.bind(this));
                this.conn.addEventListener("close", this.handleClose.bind(this));

                this.ctx = this.getContext("2d");
                this.currData = this.ctx.createImageData(this.width, this.height);
            }

            disconnectedCallback() {
                this.conn.close(1000, "disconnecting");
                console.log("Custom element removed from page.");
            }

            handleMessage(ev) {
                const data = new Uint8ClampedArray(ev.data);
                this.currData.data.set(data);
                this.syncView();
            }

            handleClose(ev) {
                console.log("WebSocket connection closed:", ev);
            }

            syncView() {
                this.ctx.putImageData(this.currData, 0, 0);
            }
        }

        customElements.define("projection-view", ProjectionView, { extends: "canvas" });
    </script>
</head>

<body>
    <div class="container">
        <h1>Camera for Situation Awareness</h1>

        <div class="panorama">
            <canvas is="projection-view" id="imgview" width="1080" height="720"></canvas>
        </div>

        <div class="view-selector">
            <button>View 1</button>
            <button>View 2</button>
            <button>View 3</button>
            <button>View 4</button>
            <button>360 View</button>
        </div>

        <div class="current-view">
            <p>Current View: 360</p>
        </div>

        <div class="info-panels">
            <div class="object-warning">
                <h2>Object Warning</h2>
                <p>Object approaching...</p>
                <div class="object-tags">
                    <span>Object 1</span>
                    <span>Object 2</span>
                    <span>Object 3</span>
                </div>
            </div>

            <div class="statistics">
                <h3>3:10 PM</h3>
                <h2>Statistics</h2>
                <ul>
                    <li><strong>Confidence Score:</strong> 28%</li>
                    <li><strong>Alert Message:</strong> Impact highly likely</li>
                    <li><strong>Detection location:</strong> East</li>
                </ul>
            </div>
        </div>
    </div>
</body>

</html>
